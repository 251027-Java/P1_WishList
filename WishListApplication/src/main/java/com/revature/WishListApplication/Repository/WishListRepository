package com.example.repository;

import java.sql.*;
import java.util.List;
import java.util.ArrayList;

public class WishListRepository{
    private static final String Postgre_URL = "jdbc:postgresql://localhost:5432/postgres";
    private static final String Postgre_User = "postgres";
    private static final String Postgre_PW = "secret";
    private Connection connection;
    
    public WishListRepository() throws SQLException{
        try{
            connection = DriverManager.getConnection(Postgre_URL, Postgre_User, Postgre_PW);
            try (Statement stmt = connection.createStatement()) {
                String sql =
                    "CREATE TABLE "User" (
                        userID      SERIAL PRIMARY KEY,
                        username    VARCHAR(100) NOT NULL UNIQUE,
                        password    VARCHAR(200) NOT NULL
                    );

                    CREATE TABLE Wishlist (
                        wishlistID  SERIAL PRIMARY KEY,
                        userID      INT NOT NULL,
                        FOREIGN KEY (userID)
                            REFERENCES "User"(userID)
                            ON DELETE CASCADE
                    );

                    CREATE TABLE Brands (
                        brandID     SERIAL PRIMARY KEY,
                        name        VARCHAR(150) NOT NULL
                    );

                    CREATE TABLE Item (
                        itemID      SERIAL PRIMARY KEY,
                        name        VARCHAR(150) NOT NULL,
                        brandID     INT NOT NULL,
                        price       DECIMAL(10,2) NOT NULL,
                        FOREIGN KEY (brandID)
                            REFERENCES Brands(brandID)
                            ON DELETE SET NULL
                    );

                    CREATE TABLE Wishlist_Item (
                        wishlistID  INT NOT NULL,
                        itemID      INT NOT NULL,
                        PRIMARY KEY (wishlistID, itemID),
                        FOREIGN KEY (wishlistID)
                            REFERENCES Wishlist(wishlistID)
                            ON DELETE CASCADE,
                        FOREIGN KEY (itemID)
                            REFERENCES Item(itemID)
                            ON DELETE CASCADE
                    );";
                stmt.execute(sql);
                System.out.println("Successful connection to PostgreSQl database");
            }
        } catch (SQLException e) {
            System.out.println("Unable to connect to PostgreSQL database");
        }
    }

}
